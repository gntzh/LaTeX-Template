\SetupKeyvalOptions{family=vCode, prefix=vCode@, setkeys=\kvsetkeys}

\DeclareStringOption[cn]{lang}

\DeclareVoidOption{en}{\kvsetkeys{vCode}{lang=en}}
\DeclareVoidOption{cn}{\kvsetkeys{vCode}{lang=cn}}

\ProcessKeyvalOptions*\relax

\RequirePackage{listings}
\RequirePackage{xcolor}

\RequirePackage{tcolorbox}
\tcbuselibrary{listings}
\tcbset{listing engine=listings}

\lstset{ % 默认风格设置
  % 编程语言
  language=Python,
  morekeywords={},                 % if you want to add more keywords to the set
  deletekeywords={},               % if you want to delete keywords from the given language
  % 基础风格
  % backgroundcolor=\color[HTML]{f6f6f6},  % choose the background color; you must add \RequirePackage{color} or \RequirePackage{xcolor}
  basicstyle=\ttfamily,            % the size of the fonts that are used for the code
  identifierstyle=\color[HTML]{0084ff},
  keywordstyle=\bfseries\color{black},
  ndkeywordstyle=\color{teal},
  stringstyle=\color[HTML]{669900},
  commentstyle=\itshape\color[HTML]{999999},
  xleftmargin=0em, 
  % 边框
  frame=shadowbox,                 % adds a frame around the code
  framexleftmargin=0em,
  rulecolor={},         % if not set, the frame-color may be changed on line-breaks within not-black text (e.g. comments (green here))
  rulesepcolor=\color{darkgray},
  % 行号
  numbers=none,                    % where to put the line-numbers; possible values are (none, left, right)
  stepnumber=1,                    % the step between two line-numbers. If it's 1, each line will be numbered
  numbersep=5pt,                   % how far the line-numbers are from the code
  numberstyle=\scriptsize\color{darkgray}, % the style that is used for the line-numbers
  % 其他
  captionpos=b,                    % sets the caption-position to bottom
  breaklines=true,                 % sets automatic line breaking
  breakatwhitespace=false,         % sets if automatic breaks should only happen at whitespace
  escapeinside={},                 % if you want to add LaTeX within your code
  keepspaces=true,                 % keeps spaces in text, useful for keeping indentation of code (possibly needs columns=flexible)
  flexiblecolumns,
  columns=fixed,
  showspaces=false,                % show spaces everywhere adding particular underscores; it overrides 'showstringspaces'
  showstringspaces=false,          % underline spaces within strings only
  showtabs=false,                  % show tabs within strings adding particular underscores
  tabsize=4,                       % sets default tabsize to 2 spaces
  title=\lstname,                  % show the filename of files included with \lstinputlisting; also try caption instead of title
}

% 自定义风格
\lstdefinestyle{lm}{
    numbers             =   left,
}

\definecolor{box_back}{RGB}{245,244,250}
\definecolor{box_back_title}{RGB}{235,233,245}
\definecolor{box_title}{RGB}{177,177,177}
\definecolor{box_no}{RGB}{202,202,202}

\lstdefinestyle{tcb}{
  backgroundcolor= {},
  frame=none,
  numbers=none,
}

\newtcblisting{code}[2][]{
    listing options={style=tcb,language=#2},
    % 公共样式
    left=1.5em,
    top=0.1em,
    bottom=0.1em,
    listing engine=listings,
    listing only,
    colback=box_back,
    colframe=box_back_title,
    #1
}

\newtcbinputlisting{inputcode}[3][]{%参考自https://reishin.me/tmux/ 的代码框样式
    listing file={#2},
    listing options={style=tcb,language=#3},
    % 公共样式
    left=1.5em,
    top=0.1em,
    bottom=0.1em,
    listing engine=listings,
    listing only,
    colback=box_back,
    colframe=box_back_title,
    #1
}

\newtcblisting{shell}[1][]{
    colupper=darkgray,
    listing options={language=sh,style=tcb},
    every listing line={\textcolor{green!40!black}{\small\ttfamily\bfseries root \$> }},
    % 公共样式
    left=1.5em,
    top=0.1em,
    bottom=0.1em,
    listing engine=listings,
    listing only,
    colback=box_back,
    colframe=box_back_title,
    #1
}


\ifdefstring{\vCode@lang}{cn}{
  \renewcommand{\lstlistingname}{代码}
}

\endinput