\RequirePackage{kvoptions}
\RequirePackage{etoolbox}

\SetupKeyvalOptions{family=vMath, prefix=vMath@, setkeys=\kvsetkeys}

\DeclareStringOption[cn]{lang}
\DeclareVoidOption{en}{\kvsetkeys{vMath}{lang=en}}
\DeclareVoidOption{cn}{\kvsetkeys{vMath}{lang=cn}}

\DeclareBoolOption[true]{fancy}
\DeclareComplementaryOption{plain}{fancy}

\ProcessKeyvalOptions*\relax

\RequirePackage{amsmath}%提供数学公式支持
% 提供完整的符号命令, 不需要upgreek和bm等数学字体宏包
\RequirePackage[math-style=ISO]{unicode-math} % 
\RequirePackage{pgfplots} % 函数图
\pgfplotsset{compat=newest} % 向后兼容

% 自定义公式
\providecommand\Vector{\symbfup}

% 定理环境
\providecommand{\proofname}{Proof} % {证明}
\providecommand{\theoremname}{Theorem} % {定理}
\providecommand{\axiomname}{Axiom} % {公理}
\providecommand{\lemmaname}{Lemma} % {引理}
\providecommand{\corollaryname}{Corollary} %{推论}
\providecommand{\assertionname}{Assertion} %{断言}
\providecommand{\propositionname}{Proposition} %{命题}
\providecommand{\conjecturename}{Conjecture} %{猜想}
\providecommand{\definitionname}{Definition} %{定义}
\providecommand{\examplename}{Example} %{例}
\providecommand{\remarkname}{Remark} %{注}
\providecommand{\notename}{Note} %{笔记}

\ifdefstring{\vMath@lang}{cn}{
  % \\(.+?)(\{.+?\})(\{.+?\}).*?(\{.+\})
  % \\$1$2$4 % $3
  \renewcommand*{\proofname}{证明} % {Proof}
  \renewcommand{\theoremname}{定理} % {Theorem}
  \renewcommand{\axiomname}{公理} % {Axiom}
  \renewcommand{\lemmaname}{引理} % {Lemma}
  \renewcommand{\corollaryname}{推论} % {Corollary}
  \renewcommand{\assertionname}{断言} % {Assertion}
  \renewcommand{\propositionname}{命题} % {Proposition}
  \renewcommand{\conjecturename}{猜想} % {Conjecture}
  \renewcommand{\definitionname}{定义} % {Definition}
  \renewcommand{\examplename}{例} % {Example}
  \renewcommand{\remarkname}{注} % {Remark}
  \renewcommand{\notename}{笔记} % {Note}
}{}

\ifdefstring{\vMath@lang}{en}{}{}

\RequirePackage{tcolorbox}
\tcbuselibrary{most}

\tcbset{
  thmCommon/.style = {
    enhanced,
    breakable,
    coltitle = white,
    colback = white,
    fontupper = \itshape,
    fonttitle = \sffamily\bfseries,
    lower separated = false,
    boxrule = 0.5pt,
    top=8pt,
    before skip=8pt,
    attach boxed title to top left={
      yshift=-0.11in,
      xshift=0.15in,
    },
    boxed title style={
      colframe=white,
      colback=black!75,
      boxrule=0pt,
      arc=0pt,
      outer arc=0pt,
    },
    separator sign={},
  }
}

\ifvMath@fancy
  \newtcbtheorem[auto counter]{proof}{\proofname}{thmCommon}{thm}
  \newtcbtheorem[auto counter]{theorem}{\theoremname}{thmCommon}{thm}
  \newtcbtheorem[auto counter]{axiom}{\axiomname}{thmCommon}{axi}
  \newtcbtheorem[auto counter]{lemma}{\lemmaname}{thmCommon}{lem}
  \newtcbtheorem[auto counter]{corollary}{\corollaryname}{thmCommon}{cor}
  \newtcbtheorem[auto counter]{assertion}{\assertionname}{thmCommon}{ast}
  \newtcbtheorem[auto counter]{proposition}{\propositionname}{thmCommon}{pro}
  \newtcbtheorem[auto counter]{conjecture}{\conjecturename}{thmCommon}{con}
  \newtcbtheorem[auto counter]{definition}{\definitionname}{thmCommon}{def}
  \newtcbtheorem[auto counter]{example}{\examplename}{thmCommon}{exa}
  \newtcbtheorem[auto counter]{remark}{\remarkname}{thmCommon}{rem}
  \newtcbtheorem[auto counter]{note}{\notename}{thmCommon}{note}
\else
  \RequirePackage{amsthm}
  \theoremstyle{plain}
  % Proof
  \newtheorem{vProof}{\theoremname}
  \renewenvironment{proof}[2]{
    \ignorespaces\ifstrempty{#1}{\vProof}{\vProof[#1]}\ifstrempty{#2}{}{\label{thm:#2}}}{
    \endvProof
  }
  \newtheorem*{vvProof}{\theoremname}
  \newenvironment{proof*}[1]
    {\ignorespaces\ifstrempty{#1}{\vvProof}{\vvProof[#1]}}
    {\endvvProof}
  % Theorem
  \newtheorem{vTheorem}{\theoremname}
  \newenvironment{theorem}[2]{
    \ignorespaces\ifstrempty{#1}{\vTheorem}{\vTheorem[#1]}\ifstrempty{#2}{}{\label{thm:#2}}}{
    \endvTheorem
  }
  \newtheorem*{vvTheorem}{\theoremname}
  \newenvironment{theorem*}[1]
    {\ignorespaces\ifstrempty{#1}{\vvTheorem}{\vvTheorem[#1]}}
    {\endvvTheorem}
  % Axiom
  \newtheorem{vAxiom}{\axiomname}
  \newenvironment{axiom}[2]{
    \ignorespaces\ifstrempty{#1}{\vAxiom}{\vAxiom[#1]}\ifstrempty{#2}{}{\label{axi:#2}}}{
    \endvAxiom
  }
  \newtheorem*{vvAxiom}{\axiomname}
  \newenvironment{axiom*}[1]
    {\ignorespaces\ifstrempty{#1}{\vvAxiom}{\vvAxiom[#1]}}
    {\endvvAxiom}
  % Lemma
  \newtheorem{vLemma}{\lemmaname}
  \newenvironment{lemma}[2]{
    \ignorespaces\ifstrempty{#1}{\vLemma}{\vLemma[#1]}\ifstrempty{#2}{}{\label{axi:#2}}}{
    \endvLemma
  }
  \newtheorem*{vvLemma}{\lemmaname}
  \newenvironment{lemma*}[1]
    {\ignorespaces\ifstrempty{#1}{\vvLemma}{\vvLemma[#1]}}
    {\endvvLemma}
  % Corollary 
  \newtheorem{vCorollary}{\corollaryname}
  \newenvironment{corollary}[2]{
    \ignorespaces\ifstrempty{#1}{\vCorollary}{\vCorollary[#1]}\ifstrempty{#2}{}{\label{axi:#2}}}{
    \endvCorollary
  }
  \newtheorem*{vvCorollary}{\corollaryname}
  \newenvironment{corollary*}[1]
    {\ignorespaces\ifstrempty{#1}{\vvCorollary}{\vvCorollary[#1]}}
    {\endvvCorollary}
  % Aassertion
  \newtheorem{vAssertion}{\assertionname}
  \newenvironment{assertion}[2]{
    \ignorespaces\ifstrempty{#1}{\vAssertion}{\vAssertion[#1]}\ifstrempty{#2}{}{\label{axi:#2}}}{
    \endvAssertion
  }
  \newtheorem*{vvAssertion}{\assertionname}
  \newenvironment{assertion*}[1]
    {\ignorespaces\ifstrempty{#1}{\vvAssertion}{\vvAssertion[#1]}}
    {\endvvAssertion}
  % Proposition
  \newtheorem{vProposition}{\propositionname}
  \newenvironment{proposition}[2]{
    \ignorespaces\ifstrempty{#1}{\vProposition}{\vProposition[#1]}\ifstrempty{#2}{}{\label{axi:#2}}}{
    \endvProposition
  }
  \newtheorem*{vvProposition}{\propositionname}
  \newenvironment{proposition*}[1]
    {\ignorespaces\ifstrempty{#1}{\vvProposition}{\vvProposition[#1]}}
    {\endvvProposition}
  % Conjecture
  \newtheorem{vConjecture}{\conjecturename}
  \newenvironment{conjecture}[2]{
    \ignorespaces\ifstrempty{#1}{\vConjecture}{\vConjecture[#1]}\ifstrempty{#2}{}{\label{axi:#2}}}{
    \endvConjecture
  }
  \newtheorem*{vvConjecture}{\conjecturename}
  \newenvironment{conjecture*}[1]
    {\ignorespaces\ifstrempty{#1}{\vvConjecture}{\vvConjecture[#1]}}
    {\endvvConjecture}

  \theoremstyle{vDefinition}
  % Definition
  \newtheorem{vDefinition}{\conjecturename}
  \newenvironment{definition}[2]{
    \ignorespaces\ifstrempty{#1}{\vDefinition}{\vDefinition[#1]}\ifstrempty{#2}{}{\label{axi:#2}}}{
    \endvDefinition
  }
  \newtheorem*{vvDefinition}{\conjecturename}
  \newenvironment{definition*}[1]
    {\ignorespaces\ifstrempty{#1}{\vvDefinition}{\vvDefinition[#1]}}
    {\endvvLemma}
  % Example
  \newtheorem{vExample}{\examplename}
  \newenvironment{example}[2]{
    \ignorespaces\ifstrempty{#1}{\vExample}{\vExample[#1]}\ifstrempty{#2}{}{\label{axi:#2}}}{
    \endvExample
  }
  \newtheorem*{vvExample}{\examplename}
  \newenvironment{example*}[1]
    {\ignorespaces\ifstrempty{#1}{\vvExample}{\vvExample[#1]}}
    {\endvvExample}
  
  \theoremstyle{remark}
  % Remark
  \newtheorem{vRemark}{\remarkname}
  \newenvironment{remark}[2]{
    \ignorespaces\ifstrempty{#1}{\vRemark}{\vRemark[#1]}\ifstrempty{#2}{}{\label{axi:#2}}}{
    \endvRemark
  }
  \newtheorem*{vvRemark}{\remarkname}
  \newenvironment{remark*}[1]
    {\ignorespaces\ifstrempty{#1}{\vvRemark}{\vvRemark[#1]}}
    {\endvvRemark}
  % Note
  \newtheorem{vNote}{\remarkname}
  \newenvironment{note}[2]{
    \ignorespaces\ifstrempty{#1}{\vNote}{\vNote[#1]}\ifstrempty{#2}{}{\label{axi:#2}}}{
    \endvNote
  }
  \newtheorem*{vvNote}{\remarkname}
  \newenvironment{note*}[1]
    {\ignorespaces\ifstrempty{#1}{\vvNote}{\vvNote[#1]}}
    {\endvvNote}

\fi

\endinput